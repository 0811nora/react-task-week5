import {  useNavigate,  useParams } from "react-router-dom";
import PageTransition from "../components/PageTransition";
import { useState, useEffect} from "react";
import { getAllProducts } from "../api/Api";
import ProductCard from "../components/ProdeuctCard";



function ProductDetail() {

    const { id } = useParams();
    const navigate = useNavigate();

    const [ allProduct , setAllProduct ] = useState([]);
    const [ num , setNum ] = useState(1);
    const [ recommendData , setRecommendData ] = useState([]);

    useEffect(()=>{
        console.log(allProduct)
    },[allProduct])

    const  randomProducts = (products) => {
        return [...products]
            .sort(() => Math.random() - 0.5)
            .slice(0, 8);
    }

    useEffect(() => {
        const getProductData = async () => {
            try{
                const res = await getAllProducts();
                setAllProduct(res.data.products);
                setRecommendData(randomProducts(res.data.products));
                
            }catch(err){
                console.log(err)
            }
        }
        getProductData();
    },[])

    const targetData = allProduct.find((item) =>item.id === id);


    return(<>
        <PageTransition>
            <main className="productDetail bg-primary " style={{ minHeight: '88vh' }}>
                <div className="container py-5">
                    <div className="mb-5">
                        <button onClick={() => navigate("/product")} className="btn btn-text  drakBtn">
                            <i class="bi bi-arrow-left"></i> 馬卡龍列表
                        </button>
                    </div>
                    <div className="mx-auto mb-5" style={{maxWidth:"960px"}}>
                        <div className="bg-dark p-3">
                            <div className="row">
                                <div className="col-7 p-4 d-flex flex-column">
                                    <div className="text-white ">
                                        <h2 className="mb-3 fs-1">{targetData?.title}</h2>
                                        <div className="mb-3">
                                            {targetData?.tags.map( (i) =>(
                                                <span className="badge bg-primary me-2 text-dark">{i}</span>
                                            ) )}
                                        </div>
                                        <p className="fs-1 mb-2 fw-bolder">$ {targetData?.price}</p>
                                        <p>{targetData?.content}</p>
                                    </div>
                                    <div className="d-flex justify-content-between mt-auto">
                                        <div className="countBtn">
                                            <button onClick={() => setNum( num <= 1 ? 1 : num-1)}><i class="bi bi-dash"></i></button>
                                            <span className="fs-5 fw-bolder text-white px-4" value={num}>{num}</span>
                                            <button onClick={() => setNum(num +1)}><i class="bi bi-plus-lg"></i></button>
                                        </div>
                                        <div className="">
                                            <button className="btn btn-primary px-4  rounded-0 addCartBtn">
                                                <i class="bi bi-plus-lg me-2"></i>購物車
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div className="col-5">
                                    <div className="bg-dark">
                                        <img src={targetData?.imageUrl} alt="" />
                                    </div>
                                </div>

                            </div>
                        </div>
                        
                    </div>

                    <div className="py-5">
                        <h2 className="text-center fw-bolder mb-5">熱門推薦</h2>
                        <div className="mx-auto" style={{maxWidth:"960px"}}>
                            <ProductCard data={recommendData}/>
                        </div>
                    </div>
                </div>

            </main>
        </PageTransition>
    </>)
}

export default ProductDetail;